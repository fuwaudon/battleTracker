<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>カードゲーム 戦績トラッカー</title>
<style>
    body {
        background: #0f1a2b;
        color: #fff;
        font-family: Arial, sans-serif;
        padding: 20px;
    }
    h1,h2 { margin-bottom:10px; }
    h2 { border-bottom:1px solid #446; padding-bottom:4px; }

    .section {
        background: #16233a;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 8px;
    }
    input, select, button {
        padding: 6px;
        margin: 4px 0;
        background: #223354;
        color: #fff;
        border: 1px solid #334;
        border-radius: 4px;
    }
    button {
        cursor: pointer;
        background: #345;
    }

    .deck-list {
        max-height: 150px;
        overflow-y: auto;
        padding-right: 4px;
    }

    .deck-item {
        display: flex;
        justify-content: space-between;
        padding: 5px 0;
    }
    .delete-btn {
        cursor: pointer;
        color: #f88;
        font-weight: bold;
    }

    .stats-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }
    .stats-table th, .stats-table td {
        padding: 6px;
        border-bottom: 1px solid #445;
        text-align: center;
    }

    .rate-green { color: #4fff4f; }
    .rate-red { color: #ff6b6b; }
    .rate-white { color: #ffffff; }

    /* ===== スマホ対応 RWD ===== */
    @media (max-width: 600px) {
        #statsDeckSelect { display: none; }

        input, select, button {
            font-size: 16px;
            padding: 10px;
        }

        .section { padding: 20px; }

        .deck-list { max-height: 200px; }
    }
</style>
</head>
<body>

<h1>カードゲーム 戦績トラッカー</h1>

<!-- 自分デッキ登録 -->
<div class="section">
    <h2>自分のデッキ登録（最大5）</h2>
    <input id="myDeckName" placeholder="デッキ名">
    <button onclick="addMyDeck()">追加</button>
    <div id="myDeckList" class="deck-list"></div>
</div>

<!-- 相手デッキ登録 -->
<div class="section">
    <h2>相手のデッキ登録（無制限）</h2>
    <input id="opDeckName" placeholder="デッキ名">
    <button onclick="addOpDeck()">追加</button>
    <div id="opDeckList" class="deck-list"></div>
</div>

<!-- 戦績登録 -->
<div class="section">
    <h2>戦績登録</h2>

    <select id="useMyDeck"></select>
    <select id="useOpDeck"></select>


    <div style="margin-top:10px;">
        <span>勝敗：</span>
        <button onclick="setResult('勝ち')">勝ち</button>
        <button onclick="setResult('負け')">負け</button>
        <span id="resultLabel"></span>
    </div>

    <button style="margin-top:10px;" onclick="registerResult()">戦績を登録</button>
</div>

<!-- 戦績表示 -->
<div class="section">
    <h2>戦績表示</h2>

    <select id="statsDeckSelect" onchange="showStats()"></select>

    <div id="statsOutput"></div>
</div>

<!-- データリセット -->
<div class="section">
    <h2>データリセット</h2>
    <button onclick="resetData()">データを全てリセット</button>
    <p>※押すと「本当にリセットしますか？」と確認が出ます</p>
</div>

<script>
let myDecks = JSON.parse(localStorage.getItem("myDecks") || "[]");
let opDecks = JSON.parse(localStorage.getItem("opDecks") || "[]");
let matches = JSON.parse(localStorage.getItem("matches") || "[]");

let tempOrder = "";
let tempResult = "";

function saveAll() {
    localStorage.setItem("myDecks", JSON.stringify(myDecks));
    localStorage.setItem("opDecks", JSON.stringify(opDecks));
    localStorage.setItem("matches", JSON.stringify(matches));
}

function addMyDeck() {
    const name = document.getElementById("myDeckName").value.trim();
    if (!name) return;
    if (myDecks.length >= 5) { alert("自分のデッキは5つまでです。"); return; }
    myDecks.push(name);
    saveAll();
    document.getElementById("myDeckName").value = "";
    renderLists();
}

function addOpDeck() {
    const name = document.getElementById("opDeckName").value.trim();
    if (!name) return;
    opDecks.push(name);
    saveAll();
    document.getElementById("opDeckName").value = "";
    renderLists();
}

function deleteMyDeck(i) { myDecks.splice(i,1); saveAll(); renderLists(); }
function deleteOpDeck(i) { opDecks.splice(i,1); saveAll(); renderLists(); }

function setOrder(o) { tempOrder = o; document.getElementById("orderLabel").textContent = o; }
function setResult(r) { tempResult = r; document.getElementById("resultLabel").textContent = r; }

function registerResult() {
    const md = document.getElementById("useMyDeck").value;
    const od = document.getElementById("useOpDeck").value;
    if (!md || !od || !tempOrder || !tempResult) { alert("すべて選択してください。"); return; }
    matches.push({ my: md, op: od, order: tempOrder, result: tempResult });
    saveAll();
    tempOrder = ""; tempResult = "";
    document.getElementById("orderLabel").textContent = "";
    document.getElementById("resultLabel").textContent = "";
    showStats();
}

function showStats() {
    const deck = document.getElementById("statsDeckSelect").value;
    if (!deck) return;
    const list = matches.filter(m=>m.my===deck);
    let total = list.length;
    let win = list.filter(m=>m.result==="勝ち").length;

    function rate(n,d){
        if(d===0) return "-";
        const r=(n/d*100).toFixed(1);
        let cls="rate-white";
        if(r>=60) cls="rate-green";
        else if(r<35) cls="rate-red";
        return `<span class="${cls}">${r}%</span>`;
    }

    let html=`<h3>全体戦績</h3>
    <table class="stats-table">
    <tr><th>試合数</th><th>勝利</th><th>勝率</th></tr>
    <tr><td>${total}</td><td>${win}</td><td>${rate(win,total)}</td></tr>
    </table>`;

    const opGrouped={};
    list.forEach(m=>{ if(!opGrouped[m.op]) opGrouped[m.op]=[]; opGrouped[m.op].push(m); });

    let sorted=Object.entries(opGrouped).map(([op,arr])=>({op,total:arr.length,win:arr.filter(x=>x.result==="勝ち").length}));
    sorted.sort((a,b)=>b.total-a.total);

    html+=`<h3>相手デッキ別（対戦数の多い順）</h3>
    <table class="stats-table">
    <tr><th>相手デッキ</th><th>試合</th><th>勝ち</th><th>勝率</th></tr>`;
    sorted.forEach(row=>{
        html+=`<tr><td>${row.op}</td><td>${row.total}</td><td>${row.win}</td><td>${rate(row.win,row.total)}</td></tr>`;
    });
    html+=`</table>`;

    document.getElementById("statsOutput").innerHTML=html;
}

function renderLists(){
    const myList=document.getElementById("myDeckList");
    const opList=document.getElementById("opDeckList");
    const mySel=document.getElementById("useMyDeck");
    const opSel=document.getElementById("useOpDeck");
    const statsSel=document.getElementById("statsDeckSelect");

    myList.innerHTML=myDecks.map((d,i)=>`<div class="deck-item">${d}<span class="delete-btn" onclick="deleteMyDeck(${i})">✖</span></div>`).join("");
    opList.innerHTML=opDecks.map((d,i)=>`<div class="deck-item">${d}<span class="delete-btn" onclick="deleteOpDeck(${i})">✖</span></div>`).join("");

    mySel.innerHTML=myDecks.map(d=>`<option>${d}</option>`).join("");
    opSel.innerHTML=opDecks.map(d=>`<option>${d}</option>`).join("");
    statsSel.innerHTML=myDecks.map(d=>`<option>${d}</option>`).join("");

    showStats();
}

function resetData(){
    if(confirm("本当にリセットしますか？")){
        localStorage.clear();
        myDecks=[]; opDecks=[]; matches=[];
        renderLists();
    }
}

renderLists();
</script>
</body>
</html>
